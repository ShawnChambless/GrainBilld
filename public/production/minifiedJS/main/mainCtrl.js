angular.module("personalProject").controller("mainCtrl",["$scope","$timeout","$location","$q","$http","mainService","grain","hops","yeast","currentUser",function(o,e,i,n,t,a,s,h,c,r){o.pageTitle=i.url(),o.showHopsBox=!1,o.showYeastBox=!1,o.showGrainInfo=!1,o.showHopsInfo=!1,o.showYeastInfo=!1,o.grainBoxToggle={rotate:!1},o.hopsBoxToggle={rotate:!1},o.yeastBoxToggle={rotate:!1},o.grainInDb=s.data,o.hopsInDb=h.data,o.yeastInDb=c.data,o.grainInRecipe=[],o.hopsInRecipe=[],o.yeastInRecipe=[];o.batchSize||(o.batchSize=5),o.efficiency||(o.efficiency=75),o.rotateGrain=function(){o.grainBoxToggle.rotate=!0,e(function(){o.grainBoxToggle.rotate=!1},255,!0)},o.rotateHops=function(){o.hopsBoxToggle.rotate=!0,e(function(){o.hopsBoxToggle.rotate=!1},255,!0)},o.rotateYeast=function(){o.yeastBoxToggle.rotate=!0,e(function(){o.yeastBoxToggle.rotate=!1},255,!0)},o.showGrainFunction=function(){o.showGrainBox=!o.showGrainBox,o.showHopsBox=!1,o.showYeastBox=!1},o.showHopsFunction=function(){o.showHopsBox=!o.showHopsBox,o.showGrainBox=!1,o.showYeastBox=!1},o.showYeastFunction=function(){o.showYeastBox=!o.showYeastBox,o.showGrainBox=!1,o.showHopsBox=!1},o.addToGrainSearchText=function(e){o.grainSearchText=e.name},o.addToHopsSearchText=function(e){o.hopsSearchText=e.name},o.addToYeastSearchText=function(e){o.yeastSearchText=e.name};var p,g;o.addGrainToRecipe=function(e){o.OG||(o.OG=1),a.getGrainsInDb(e).then(function(e){a.grainInRecipe.push(e.data[0]._id),a.grainAmount.push(o.grainWeight),o.grainSearchText="",o.grainInRecipe.push({grain:e.data[0],amount:o.grainWeight}),console.log(e,o.grainInRecipe,a.grainInRecipe),g?(p=g+1e3*(parseFloat(e.data[0].sg)-1)*o.grainWeight,g=p):(g=1e3*(e.data[0].sg-1)*o.grainWeight,p=g);var i=parseFloat(e.data[0].lovibond*o.grainWeight/o.batchSize);o.recipeSrm=(1.4922*Math.pow(i,.6859)).toFixed(1),o.OG=(.75*p/o.batchSize/1e3+1).toFixed(3)})};var l,u;o.addHopsToRecipe=function(e){a.getHopsInDb(e).then(function(e){a.hopsInRecipe.push(e.data[0]._id),a.hopsAmount.push(o.hopWeight),a.boilTime.push(o.boilTime),o.hopsSearchText="",o.hopsInRecipe.push({hop:e.data[0],amount:o.hopWeight,boil:o.boilTime});var i;0===o.boilTime?i=0:o.boilTime>0&&o.boilTime<=9?i=.05:o.boilTime>9&&o.boilTime<=19?i=.12:o.boilTime>19&&o.boilTime<=29?i=.15:o.boilTime>29&&o.boilTime<=44?i=.19:o.boilTime>44&&o.boilTime<=59?i=.22:o.boilTime>59&&o.boilTime<=74?i=.24:o.boilTime>74&&(i=.27);var n=o.hopWeight*e.data[0].alphaAcid;u?(l=n*i*74.89/o.batchSize+u,u=l,o.IBU=l.toFixed(1)):(l=n*i*74.89/o.batchSize,u=l,o.IBU=l.toFixed(1))})},o.addYeastToRecipe=function(e){a.getYeastInDb(e).then(function(e){a.yeastInRecipe.push(e.data[0]._id),console.log(a.grainInRecipe,a.hopsInRecipe,a.yeastInRecipe,a.hopsAmount,a.grainAmount),o.yeastSearchText="",o.yeastInRecipe.push(e.data[0]),o.FG=(o.OG/(o.yeastInRecipe[0].maximumAttenuation/100)/1e3+1).toFixed(3),o.ABV=(76.08*(o.OG-o.FG)/(1.775-o.OG)*(o.FG/.794)).toFixed(2)})},o.toggleGrainInfo=function(){o.showGrainInfo=!o.showGrainInfo,o.showHopsInfo=!1,o.showYeastInfo=!1},o.toggleHopsInfo=function(){o.showHopsInfo=!o.showHopsInfo,o.showGrainInfo=!1,o.showYeastInfo=!1},o.toggleYeastInfo=function(){o.showYeastInfo=!o.showYeastInfo,o.showGrainInfo=!1,o.showHopsInfo=!1},o.saveRecipe=function(e,i,n,t,p,g,l,u,f,I,T){a.saveRecipe(s,h,c,o.recipeName,o.batchSize,o.efficiency,o.IBU,o.OG,o.FG,o.ABV,o.recipeSrm,r).then(function(o){console.log(o)})}}]);