angular.module("personalProject",["angular-loading-bar","ui.router","angucomplete-alt","ngAnimate"]).config(["$stateProvider","$urlRouterProvider",function(e,n){var t=function(e,n){return e.getCurrentUser().then(function(t){return e.currentUser()||n.go("login"),t})};t.$inject=["loginService","$state"],e.state("login",{url:"/login",templateUrl:"app/login/loginTmpl.html",controller:"loginCtrl",resolve:{sessionLogin:["loginService","$state",function(e,n){e.getCurrentUser().then(function(t){return e.currentUser()&&n.go("NewBatch"),t})}]}}).state("MyRecipes",{url:"/MyRecipes",templateUrl:"app/myRecipes/myRecipesTmpl.html",controller:"recipeCtrl",resolve:{currentUser:t,retrieveRecipes:["recipeService","loginService","$state",function(e,n,t){return n.getCurrentUser().then(function(){return n.currentUser()?e.getRecipes(n.currentUser()._id).then(function(n){return e.user=n.data,n.data}):void t.go("login")})}]}}).state("IngredientInfo",{url:"/IngredientInfo",templateUrl:"app/ingredientInfo/ingredientInfoTmpl.html",controller:"ingredientInfoCtrl",resolve:{grain:["mainService",function(e){return e.getGrainsInDb().then(function(e){return e})}],hops:["mainService",function(e){return e.getHopsInDb().then(function(e){return e})}],yeast:["mainService",function(e){return e.getYeastInDb().then(function(e){return e})}]}}).state("NewBatch",{url:"/NewBatch",templateUrl:"app/main/mainTmpl.html",controller:"mainCtrl",resolve:{grain:["mainService",function(e){return e.getGrainsInDb().then(function(e){return e})}],hops:["mainService",function(e){return e.getHopsInDb().then(function(e){return e})}],yeast:["mainService",function(e){return e.getYeastInDb().then(function(e){return e})}]}}).state("database",{url:"/database",templateUrl:"app/database/databaseTmpl.html",controller:"databaseCtrl",resolve:{grain:["mainService",function(e){return e.getGrainsInDb().then(function(e){return e})}],hops:["mainService",function(e){return e.getHopsInDb().then(function(e){return e})}],yeast:["mainService",function(e){return e.getYeastInDb().then(function(e){return e})}]}}),n.otherwise("/login")}]).config(["cfpLoadingBarProvider",function(e){e.latencyThreshold=10}]);
angular.module("personalProject").controller("databaseCtrl",["$scope","$http","$q","mainService","grain","hops","yeast",function(t,a,n,e,d,i,o){t.grainsInDb=d.data,t.hopsInDb=i.data,t.yeastInDb=o.data,t.updateGrainSG=function(a,n){e.updateSG(a,n).then(function(a){t.updateSG=""})},t.addGrainToDb=function(n){return a({method:"POST",url:"http://grainbilld.com/database/ingredients/grain",data:n}).then(function(a){t.grain=""})},t.addHopsToDb=function(n){return a({method:"POST",url:"http://grainbilld.com/database/ingredients/hops",data:n}).then(function(a){t.addHops=""})},t.addYeastToDb=function(n){return a({method:"POST",url:"http://grainbilld.com/database/ingredients/yeast",data:n}).then(function(a){t.addYeast=""})}}]);
angular.module("personalProject").controller("indexCtrl",["$scope","loginService",function(e,n){e.showNewBatch=!1,e.showIngredientInfo=!0,e.showMyRecipes=!0,e.isLoggedIn="null"!==n.currentUser()?!0:!1}]);
angular.module("personalProject").controller("ingredientInfoCtrl",["$scope","mainService","grain","hops","yeast","$location",function(a,n,e,o,t,r){a.pageTitle=r.url(),a.grainInDb=e.data,a.hopsInDb=o.data,a.yeastInDb=t.data}]);
var app=angular.module("personalProject").controller("loginCtrl",["$scope","loginService","$state","$timeout",function(o,n,e,r){o.showRegister=!1,o.showLogin=!0,o.register=function(r,t,c,s){n.register(r,t,c,s).then(function(n){o.showSuccess=!0,e.go("NewBatch")})["catch"](function(n){o.showError=!0})},o.login=function(r,t){n.login(r,t).then(function(n){o.showSuccess=!0,e.go("NewBatch"),o.email="",o.password="",o.showError=!1})["catch"](function(n){o.showError=!0})},o.getCurrentUser=function(o){n.getCurrentUser().then(function(o){currUser===user,e.go("NewBatch")})["catch"](function(o){console.log(o)})}}]);
angular.module("personalProject").service("loginService",["$http","$q",function(e,r){var t=null;this.currentUser=function(){return t},this.getCurrentUser=function(){var n=r.defer();return e({method:"GET",url:"http://grainbilld.com/api/user/"}).success(function(e){t=e,n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.register=function(t,n,i,o){var a=r.defer();return e({method:"POST",url:"http://grainbilld.com/auth/local/signup",data:{firstName:t,lastName:n,email:i,password:o}}).then(function(e){a.resolve(e.data)},function(e){a.reject(e)}),a.promise},this.login=function(n,i){var o=r.defer();return e({method:"POST",url:"http://grainbilld.com/auth/local/login",data:{email:n,password:i}}).then(function(e){t=e.data,o.resolve(e.data)},function(e){o.reject(e)}),o.promise}}]);
angular.module("personalProject").controller("mainCtrl",["$scope","$timeout","$location","$q","$http","mainService","grain","hops","yeast",function(o,e,i,t,a,n,s,h,r){o.pageTitle=i.url(),o.showHopsBox=!1,o.showYeastBox=!1,o.showGrainInfo=!1,o.showHopsInfo=!1,o.showYeastInfo=!1,o.grainBoxToggle={rotate:!1},o.hopsBoxToggle={rotate:!1},o.yeastBoxToggle={rotate:!1},o.grainInDb=s.data,o.hopsInDb=h.data,o.yeastInDb=r.data,o.grainInRecipe=[],o.hopsInRecipe=[],o.yeastInRecipe=[];o.batchSize||(o.batchSize=5),o.efficiency||(o.efficiency=75),o.rotateGrain=function(){o.grainBoxToggle.rotate=!0,e(function(){o.grainBoxToggle.rotate=!1},255,!0)},o.rotateHops=function(){o.hopsBoxToggle.rotate=!0,e(function(){o.hopsBoxToggle.rotate=!1},255,!0)},o.rotateYeast=function(){o.yeastBoxToggle.rotate=!0,e(function(){o.yeastBoxToggle.rotate=!1},255,!0)},o.showGrainFunction=function(){o.showGrainBox=!o.showGrainBox,o.showHopsBox=!1,o.showYeastBox=!1},o.showHopsFunction=function(){o.showHopsBox=!o.showHopsBox,o.showGrainBox=!1,o.showYeastBox=!1},o.showYeastFunction=function(){o.showYeastBox=!o.showYeastBox,o.showGrainBox=!1,o.showHopsBox=!1},o.addToGrainSearchText=function(e){o.grainSearchText=e.name},o.addToHopsSearchText=function(e){o.hopsSearchText=e.name},o.addToYeastSearchText=function(e){o.yeastSearchText=e.name};var c,p;o.addGrainToRecipe=function(e){o.OG||(o.OG=1),n.getGrainsInDb(e).then(function(e){n.grainInRecipe.push(e.data[0]._id),n.grainAmount.push(o.grainWeight),o.grainSearchText="",o.grainInRecipe.push({grain:e.data[0],amount:o.grainWeight}),p?(c=p+1e3*(parseFloat(e.data[0].sg)-1)*o.grainWeight,p=c):(p=1e3*(e.data[0].sg-1)*o.grainWeight,c=p);var i=parseFloat(e.data[0].lovibond*o.grainWeight/o.batchSize);o.recipeSrm=(1.4922*Math.pow(i,.6859)).toFixed(1),o.OG=(.75*c/o.batchSize/1e3+1).toFixed(3)})};var g,u;o.addHopsToRecipe=function(e){n.getHopsInDb(e).then(function(e){n.hopsInRecipe.push(e.data[0]._id),n.hopsAmount.push(o.hopWeight),n.boilTime.push(o.boilTime),o.hopsSearchText="",o.hopsInRecipe.push({hop:e.data[0],amount:o.hopWeight,boil:o.boilTime});var i;0===o.boilTime?i=0:o.boilTime>0&&o.boilTime<=9?i=.05:o.boilTime>9&&o.boilTime<=19?i=.12:o.boilTime>19&&o.boilTime<=29?i=.15:o.boilTime>29&&o.boilTime<=44?i=.19:o.boilTime>44&&o.boilTime<=59?i=.22:o.boilTime>59&&o.boilTime<=74?i=.24:o.boilTime>74&&(i=.27);var t=o.hopWeight*e.data[0].alphaAcid;u?(g=t*i*74.89/o.batchSize+u,u=g,o.IBU=g.toFixed(1)):(g=t*i*74.89/o.batchSize,u=g,o.IBU=g.toFixed(1))})},o.addYeastToRecipe=function(e){n.getYeastInDb(e).then(function(e){n.yeastInRecipe.push(e.data[0]._id),o.yeastSearchText="",o.yeastInRecipe.push(e.data[0]);var i=(o.yeastInRecipe[0].maximumAttenuation+o.yeastInRecipe[0].minimumAttenuation)/2;o.FG=(1+o.OG/i).toFixed(3),o.ABV=(76.08*(o.OG-o.FG)/(1.775-o.OG)*(o.FG/.794)).toFixed(2)})},o.toggleGrainInfo=function(){o.showGrainInfo=!o.showGrainInfo,o.showHopsInfo=!1,o.showYeastInfo=!1},o.toggleHopsInfo=function(){o.showHopsInfo=!o.showHopsInfo,o.showGrainInfo=!1,o.showYeastInfo=!1},o.toggleYeastInfo=function(){o.showYeastInfo=!o.showYeastInfo,o.showGrainInfo=!1,o.showHopsInfo=!1},o.saveRecipe=function(e,i,t,a,c,p,g,u,f,l,T){n.saveRecipe(s,h,r,o.recipeName,o.batchSize,o.efficiency,o.IBU,o.OG,o.FG,o.ABV,o.recipeSrm,currentUser).then(function(o){})}}]);
var app=angular.module("personalProject");app.service("mainService",["$http","$q",function(t,e){this.grainInRecipe=[],this.hopsInRecipe=[],this.yeastInRecipe=[],this.grainAmount=[],this.hopsAmount=[],this.boilTime=[],this.getGrainsInDb=function(e){return t(e?{method:"GET",url:"http://grainbilld.com/database/ingredients/grain/?name="+e}:{method:"GET",url:"http://grainbilld.com/database/ingredients/grain/"})},this.getHopsInDb=function(e){return t(e?{method:"GET",url:"http://grainbilld.com/database/ingredients/hops/?name="+e}:{method:"GET",url:"http://grainbilld.com/database/ingredients/hops/"})},this.getYeastInDb=function(e){return e?t({method:"GET",url:"http://grainbilld.com/database/ingredients/yeast/?name="+e}):t({method:"GET",url:"http://grainbilld.com/database/ingredients/yeast/"}).then(function(t){return t})},this.updateSG=function(e,i){return t({method:"PUT",url:"http://grainbilld.com/database/ingredients/grain/"+i,data:{sg:e}})},this.saveRecipe=function(e,i,n,a,r,s,o,h,d,u,m,p){return t({method:"POST",url:"http://grainbilld.com/api/recipes",data:{grain:[{name:this.grainInRecipe,amount:this.grainAmount}],hops:[{name:this.hopsInRecipe,amount:this.hopsAmount,boilTime:this.boilTime}],yeast:this.yeastInRecipe,name:a,batchSize:r,efficiency:s,ibu:o,og:h,fg:d,abv:u,srm:m,user:p}}).then(function(e){return t({method:"PUT",url:"/api/users/"+e.data.user+"/"+e.data._id})})}}]);
angular.module("personalProject").controller("recipeCtrl",["$scope","recipeService","retrieveRecipes",function(e,r,c){e.recipes=c}]);
angular.module("personalProject").service("recipeService",["$http",function(e){this.user={},this.getRecipes=function(i){return e({method:"GET",url:"http://grainbilld.com/api/recipes/"+i})}}]);