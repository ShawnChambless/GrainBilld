angular.module("personalProject",["angular-loading-bar","ui.router","angucomplete-alt","ngAnimate"]).config(["$stateProvider","$urlRouterProvider",function(e,t){var n=function(e,t){return e.getCurrentUser().then(function(n){return e.currentUser()||t.go("login"),n})};n.$inject=["loginService","$state"],e.state("login",{url:"/login",templateUrl:"app/login/loginTmpl.html",controller:"loginCtrl",resolve:{sessionLogin:["loginService","$state",function(e,t){e.getCurrentUser().then(function(n){return e.currentUser()&&t.go("NewBatch"),n})}]}}).state("MyRecipes",{url:"/MyRecipes",templateUrl:"app/myRecipes/myRecipesTmpl.html",controller:"recipeCtrl",resolve:{currentUser:n,retrieveRecipes:["recipeService","loginService","$state",function(e,t,n){return t.getCurrentUser().then(function(){return t.currentUser()?e.getRecipes(t.currentUser()._id).then(function(t){return e.user=t.data,t.data}):void n.go("login")})}]}}).state("IngredientInfo",{url:"/IngredientInfo",templateUrl:"app/ingredientInfo/ingredientInfoTmpl.html",controller:"ingredientInfoCtrl",resolve:{currentUser:n,grain:["mainService",function(e){return e.getGrainsInDb().then(function(e){return e})}],hops:["mainService",function(e){return e.getHopsInDb().then(function(e){return e})}],yeast:["mainService",function(e){return e.getYeastInDb().then(function(e){return e})}]}}).state("NewBatch",{url:"/NewBatch",templateUrl:"app/main/mainTmpl.html",controller:"mainCtrl",resolve:{currentUser:n,grain:["mainService",function(e){return e.getGrainsInDb().then(function(e){return e})}],hops:["mainService",function(e){return e.getHopsInDb().then(function(e){return e})}],yeast:["mainService",function(e){return e.getYeastInDb().then(function(e){return e})}]}}).state("database",{url:"/database",templateUrl:"app/database/databaseTmpl.html",controller:"databaseCtrl",resolve:{grain:["mainService",function(e){return e.getGrainsInDb().then(function(e){return e})}],hops:["mainService",function(e){return e.getHopsInDb().then(function(e){return e})}],yeast:["mainService",function(e){return e.getYeastInDb().then(function(e){return e})}]}}),t.otherwise("/login")}]).config(["cfpLoadingBarProvider",function(e){e.latencyThreshold=10}]),angular.module("personalProject").controller("indexCtrl",["$scope",function(e){e.showNewBatch=!1,e.showIngredientInfo=!0,e.showMyRecipes=!0}]),angular.module("personalProject").controller("databaseCtrl",["$scope","$http","$q","mainService","grain","hops","yeast",function(e,t,n,o,i,r,a){e.grainsInDb=i.data,e.hopsInDb=r.data,e.yeastInDb=a.data,e.updateGrainSG=function(t,n){o.updateSG(t,n).then(function(t){e.updateSG=""})},e.addGrainToDb=function(n){return t({method:"POST",url:"http://localhost:8080/database/ingredients/grain",data:n}).then(function(t){e.grain=""})},e.addHopsToDb=function(n){return t({method:"POST",url:"http://localhost:8080/database/ingredients/hops",data:n}).then(function(t){e.addHops=""})},e.addYeastToDb=function(n){return t({method:"POST",url:"http://localhost:8080/database/ingredients/yeast",data:n}).then(function(t){e.addYeast=""})}}]),angular.module("personalProject").controller("ingredientInfoCtrl",["$scope","mainService","grain","hops","yeast","$location",function(e,t,n,o,i,r){e.pageTitle=r.url(),e.grainInDb=n.data,e.hopsInDb=o.data,e.yeastInDb=i.data}]);var app=angular.module("personalProject").controller("loginCtrl",["$scope","loginService","$state","$timeout",function(e,t,n,o){e.showRegister=!1,e.showLogin=!0,e.register=function(o,i,r,a){t.register(o,i,r,a).then(function(t){e.showSuccess=!0,n.go("NewBatch")})["catch"](function(t){e.showError=!0})},e.login=function(o,i){t.login(o,i).then(function(t){e.showSuccess=!0,n.go("NewBatch"),e.email="",e.password="",e.showError=!1})["catch"](function(t){e.showError=!0})},e.getCurrentUser=function(e){t.getCurrentUser().then(function(e){currUser===user,n.go("NewBatch")})["catch"](function(e){console.log(e)})}}]);angular.module("personalProject").service("loginService",["$http","$q",function(e,t){var n=null;this.currentUser=function(){return n},this.getCurrentUser=function(){var o=t.defer();return e({method:"GET",url:"http://localhost:8080/api/user/"}).success(function(e){n=e,o.resolve(e)}).error(function(e){o.reject(e)}),o.promise},this.register=function(n,o,i,r){var a=t.defer();return e({method:"POST",url:"http://localhost:8080/auth/local/signup",data:{firstName:n,lastName:o,email:i,password:r}}).then(function(e){a.resolve(e.data)},function(e){a.reject(e)}),a.promise},this.login=function(o,i){var r=t.defer();return e({method:"POST",url:"http://localhost:8080/auth/local/login",data:{email:o,password:i}}).then(function(e){n=e.data,r.resolve(e.data)},function(e){r.reject(e)}),r.promise}}]),angular.module("personalProject").controller("mainCtrl",["$scope","$timeout","$location","$q","$http","mainService","grain","hops","yeast","currentUser",function(e,t,n,o,i,r,a,s,c,u){e.pageTitle=n.url(),e.showHopsBox=!1,e.showYeastBox=!1,e.showGrainInfo=!1,e.showHopsInfo=!1,e.showYeastInfo=!1,e.grainBoxToggle={rotate:!1},e.hopsBoxToggle={rotate:!1},e.yeastBoxToggle={rotate:!1},e.grainInDb=a.data,e.hopsInDb=s.data,e.yeastInDb=c.data,e.grainInRecipe=[],e.hopsInRecipe=[],e.yeastInRecipe=[];e.batchSize||(e.batchSize=5),e.efficiency||(e.efficiency=75),e.rotateGrain=function(){e.grainBoxToggle.rotate=!0,t(function(){e.grainBoxToggle.rotate=!1},255,!0)},e.rotateHops=function(){e.hopsBoxToggle.rotate=!0,t(function(){e.hopsBoxToggle.rotate=!1},255,!0)},e.rotateYeast=function(){e.yeastBoxToggle.rotate=!0,t(function(){e.yeastBoxToggle.rotate=!1},255,!0)},e.showGrainFunction=function(){e.showGrainBox=!e.showGrainBox,e.showHopsBox=!1,e.showYeastBox=!1},e.showHopsFunction=function(){e.showHopsBox=!e.showHopsBox,e.showGrainBox=!1,e.showYeastBox=!1},e.showYeastFunction=function(){e.showYeastBox=!e.showYeastBox,e.showGrainBox=!1,e.showHopsBox=!1},e.addToGrainSearchText=function(t){e.grainSearchText=t.name},e.addToHopsSearchText=function(t){e.hopsSearchText=t.name},e.addToYeastSearchText=function(t){e.yeastSearchText=t.name};var h,l;e.addGrainToRecipe=function(t){e.OG||(e.OG=1),r.getGrainsInDb(t).then(function(t){r.grainInRecipe.push(t.data[0]._id),r.grainAmount.push(e.grainWeight),e.grainSearchText="",e.grainInRecipe.push({grain:t.data[0],amount:e.grainWeight}),l?(h=l+1e3*(parseFloat(t.data[0].sg)-1)*e.grainWeight,l=h):(l=1e3*(t.data[0].sg-1)*e.grainWeight,h=l);var n=parseFloat(t.data[0].lovibond*e.grainWeight/e.batchSize);e.recipeSrm=(1.4922*Math.pow(n,.6859)).toFixed(1),e.OG=(.75*h/e.batchSize/1e3+1).toFixed(3)})};var p,g;e.addHopsToRecipe=function(t){r.getHopsInDb(t).then(function(t){r.hopsInRecipe.push(t.data[0]._id),r.hopsAmount.push(e.hopWeight),r.boilTime.push(e.boilTime),e.hopsSearchText="",e.hopsInRecipe.push({hop:t.data[0],amount:e.hopWeight,boil:e.boilTime});var n;0===e.boilTime?n=0:e.boilTime>0&&e.boilTime<=9?n=.05:e.boilTime>9&&e.boilTime<=19?n=.12:e.boilTime>19&&e.boilTime<=29?n=.15:e.boilTime>29&&e.boilTime<=44?n=.19:e.boilTime>44&&e.boilTime<=59?n=.22:e.boilTime>59&&e.boilTime<=74?n=.24:e.boilTime>74&&(n=.27);var o=e.hopWeight*t.data[0].alphaAcid;g?(p=o*n*74.89/e.batchSize+g,g=p,e.IBU=p.toFixed(1)):(p=o*n*74.89/e.batchSize,g=p,e.IBU=p.toFixed(1))})},e.addYeastToRecipe=function(t){r.getYeastInDb(t).then(function(t){r.yeastInRecipe.push(t.data[0]._id),e.yeastSearchText="",e.yeastInRecipe.push(t.data[0]);var n=(e.yeastInRecipe[0].maximumAttenuation+e.yeastInRecipe[0].minimumAttenuation)/2;e.FG=(1+e.OG/n).toFixed(3),e.ABV=(76.08*(e.OG-e.FG)/(1.775-e.OG)*(e.FG/.794)).toFixed(2)})},e.toggleGrainInfo=function(){e.showGrainInfo=!e.showGrainInfo,e.showHopsInfo=!1,e.showYeastInfo=!1},e.toggleHopsInfo=function(){e.showHopsInfo=!e.showHopsInfo,e.showGrainInfo=!1,e.showYeastInfo=!1},e.toggleYeastInfo=function(){e.showYeastInfo=!e.showYeastInfo,e.showGrainInfo=!1,e.showHopsInfo=!1},e.saveRecipe=function(t,n,o,i,h,l,p,g,d,f,m){r.saveRecipe(a,s,c,e.recipeName,e.batchSize,e.efficiency,e.IBU,e.OG,e.FG,e.ABV,e.recipeSrm,u).then(function(e){})}}]),angular.module("personalProject").service("mainService",["$http","$q",function(e,t){this.grainInRecipe=[],this.hopsInRecipe=[],this.yeastInRecipe=[],this.grainAmount=[],this.hopsAmount=[],this.boilTime=[],this.getGrainsInDb=function(t){return e(t?{method:"GET",url:"http://localhost:8080/database/ingredients/grain/?name="+t}:{method:"GET",url:"http://localhost:8080/database/ingredients/grain/"})},this.getHopsInDb=function(t){return e(t?{method:"GET",url:"http://localhost:8080/database/ingredients/hops/?name="+t}:{method:"GET",url:"http://localhost:8080/database/ingredients/hops/"})},this.getYeastInDb=function(t){return t?e({method:"GET",url:"http://localhost:8080/database/ingredients/yeast/?name="+t}):e({method:"GET",url:"http://localhost:8080/database/ingredients/yeast/"}).then(function(e){return e})},this.updateSG=function(t,n){return e({method:"PUT",url:"http://localhost:8080/database/ingredients/grain/"+n,data:{sg:t}})},this.saveRecipe=function(t,n,o,i,r,a,s,c,u,h,l,p){return e({method:"POST",url:"http://localhost:8080/api/recipes",data:{grain:[{name:this.grainInRecipe,amount:this.grainAmount}],hops:[{name:this.hopsInRecipe,amount:this.hopsAmount,boilTime:this.boilTime}],yeast:this.yeastInRecipe,name:i,batchSize:r,efficiency:a,ibu:s,og:c,fg:u,abv:h,srm:l,user:p}}).then(function(t){return e({method:"PUT",url:"/api/users/"+t.data.user+"/"+t.data._id})})}}]),angular.module("personalProject").controller("recipeCtrl",["$scope","recipeService","retrieveRecipes",function(e,t,n){e.recipes=n}]),angular.module("personalProject").service("recipeService",["$http",function(e){this.user={},this.getRecipes=function(t){return e({method:"GET",url:"http://localhost:8080/api/recipes/"+t})}}]);